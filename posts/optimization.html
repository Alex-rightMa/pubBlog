<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui"
    />
    <title>【应用专题】性能优化 | dodhood</title>
    <meta name="description" content="不忘初心，方得始终。" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="【应用专题】性能优化 | dodhood" />
    <meta property="og:site_name" content="【应用专题】性能优化 | dodhood" />
    <meta property="og:locale" content="zh-CN" />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="【应用专题】性能优化 | dodhood" />
    <link rel="shortcut icon" href="/pubBlog/favicon.ico">
    
    <link rel="preload" href="/pubBlog/assets/css/0.styles.af92ce03.css" as="style"><link rel="preload" href="/pubBlog/assets/js/app.faf67417.js" as="script"><link rel="preload" href="/pubBlog/assets/js/1.9b146cf0.js" as="script"><link rel="preload" href="/pubBlog/assets/js/14.cac7871b.js" as="script"><link rel="preload" href="/pubBlog/assets/js/5.5d06c7ea.js" as="script"><link rel="preload" href="/pubBlog/assets/js/7.33610143.js" as="script"><link rel="preload" href="/pubBlog/assets/js/9.4f15c051.js" as="script"><link rel="preload" href="/pubBlog/assets/js/6.2819461f.js" as="script"><link rel="preload" href="/pubBlog/assets/js/21.7be91ae3.js" as="script"><link rel="preload" href="/pubBlog/assets/js/13.a9af2284.js" as="script"><link rel="preload" href="/pubBlog/assets/js/15.51234656.js" as="script"><link rel="prefetch" href="/pubBlog/assets/js/10.12773369.js"><link rel="prefetch" href="/pubBlog/assets/js/11.53c678c9.js"><link rel="prefetch" href="/pubBlog/assets/js/12.8ae32e5a.js"><link rel="prefetch" href="/pubBlog/assets/js/16.23382991.js"><link rel="prefetch" href="/pubBlog/assets/js/17.68be8124.js"><link rel="prefetch" href="/pubBlog/assets/js/18.95ad111b.js"><link rel="prefetch" href="/pubBlog/assets/js/19.1c49e346.js"><link rel="prefetch" href="/pubBlog/assets/js/20.ef7d0002.js"><link rel="prefetch" href="/pubBlog/assets/js/22.60e60983.js"><link rel="prefetch" href="/pubBlog/assets/js/23.b79b322e.js"><link rel="prefetch" href="/pubBlog/assets/js/24.ff6358be.js"><link rel="prefetch" href="/pubBlog/assets/js/4.d9da0af8.js"><link rel="prefetch" href="/pubBlog/assets/js/8.2f4db8ff.js"><link rel="prefetch" href="/pubBlog/assets/js/vendors~search.64f6c7ae.js">
    <link rel="stylesheet" href="/pubBlog/assets/css/0.styles.af92ce03.css">
  </head>
  <body>
    <div id="loader-wrapper" style="display: none;opacity:0">
      <div id="loader"></div>
      <div class="loader-section section-left"></div>
      <div class="loader-section section-right"></div>
    </div>
    <div id="app" data-server-rendered="true"><div style="height:100%;" data-v-60762676><section class="el-container main-container" data-v-60762676><aside class="el-aside menu" style="width:auto;" data-v-09011f04 data-v-60762676><ul role="menubar" class="menu-wrap el-menu" style="background-color:;" data-v-09011f04><li data-v-09011f04><div class="brand-wrap" style="background-image:url(/pubBlog/brand.jpg);" data-v-09011f04><div class="brand" data-v-09011f04><a href="/pubBlog/" class="avatar waves-effect waves-circle waves-light router-link-active" data-v-09011f04><img src="/pubBlog/avatar.jpg" data-v-09011f04></a> <hgroup class="introduce" data-v-09011f04><div class="nickname" data-v-09011f04>dodhood</div> <a title="alexma2013@163.com" class="mail" data-v-09011f04>alexma2013@163.com</a></hgroup></div></div></li> <li role="menuitem" tabindex="-1" class="el-menu-item" style="padding-left:20px;color:;background-color:;" data-v-09011f04><i class="iconfont icon-home" data-v-09011f04></i> <span class="item-title" data-v-09011f04>主页</span></li> <li role="menuitem" tabindex="-1" class="el-menu-item" style="padding-left:20px;color:;background-color:;" data-v-09011f04><i class="iconfont icon-biaoqian" data-v-09011f04></i> <span class="item-title" data-v-09011f04>标签分类</span></li> <li role="menuitem" tabindex="-1" class="el-menu-item" style="padding-left:20px;color:;background-color:;" data-v-09011f04><i class="iconfont icon-wenzhang" data-v-09011f04></i> <span class="item-title" data-v-09011f04>时间归档</span></li> <li role="menuitem" tabindex="-1" class="el-menu-item" style="padding-left:20px;color:;background-color:;" data-v-09011f04><i class="iconfont icon-github" data-v-09011f04></i> <span class="item-title" data-v-09011f04>Github</span></li> <li role="menuitem" tabindex="-1" class="el-menu-item" style="padding-left:20px;color:;background-color:;" data-v-09011f04><i class="iconfont icon-aboutme" data-v-09011f04></i> <span class="item-title" data-v-09011f04>自我介绍</span></li></ul></aside> <section class="el-container container-warp" data-v-60762676><header id="topHeader" class="el-header top-header" style="height:60px;padding-left:260px;" data-v-7429231c data-v-60762676><div class="header-warp el-row is-align-middle el-row--flex" data-v-7429231c><div class="el-col el-col-12 el-col-xs-7" data-v-7429231c><div class="el-row is-align-middle el-row--flex" data-v-7429231c><div class="el-col el-col-2" data-v-7429231c><button type="button" class="el-button el-button--primary is-circle" data-v-7429231c><!----><!----><span><i class="iconfont icon-caidan" data-v-7429231c></i></span></button></div></div></div> <div class="el-col el-col-20 el-col-xs-24" data-v-7429231c><div class="grid-content bg-purple-light" data-v-7429231c><div class="el-row is-justify-end is-align-middle el-row--flex" data-v-7429231c><div class="el-col el-col-13 el-col-xs-24 el-col-sm-21 el-col-md-17 el-col-lg-13" data-v-7429231c><div aria-haspopup="listbox" role="combobox" aria-owns="el-autocomplete-5500" class="el-autocomplete search-input" data-v-7429231c><div class="el-input el-input--small el-input--suffix"><!----><input type="text" autocomplete="off" valueKey="value" popperClass="search-popper" placeholder="搜搜看" fetchSuggestions="function () { [native code] }" debounce="300" placement="bottom-start" popperAppendToBody="true" value="" class="el-input__inner"><!----><span class="el-input__suffix"><span class="el-input__suffix-inner"><i class="el-input__icon el-icon-search search-ico" data-v-7429231c></i><!----></span><!----></span><!----></div><div role="region" class="el-autocomplete-suggestion el-popper search-popper" style="width:;display:none;"><div class="el-scrollbar"><div class="el-autocomplete-suggestion__wrap el-scrollbar__wrap el-scrollbar__wrap--hidden-default"><ul class="el-scrollbar__view el-autocomplete-suggestion__list"></ul></div><div class="el-scrollbar__bar is-horizontal"><div class="el-scrollbar__thumb" style="width:0;transform:translateX(0%);ms-transform:translateX(0%);webkit-transform:translateX(0%);"></div></div><div class="el-scrollbar__bar is-vertical"><div class="el-scrollbar__thumb" style="height:0;transform:translateY(0%);ms-transform:translateY(0%);webkit-transform:translateY(0%);"></div></div></div></div></div></div></div></div></div></div></header> <main class="el-main my-main" style="margin-left:240px;" data-v-4fec0d22 data-v-60762676><div class="content-header index-header" data-v-0d2aefce data-v-4fec0d22><div class="container fade-scale in" data-v-0d2aefce><h1 id="conentHeader" class="title" data-v-0d2aefce>【应用专题】性能优化</h1> <h5 class="subtitle" data-v-0d2aefce></h5></div></div> <div data-v-62816cfb data-v-4fec0d22><div class="post-content el-row is-justify-center el-row--flex" data-v-62816cfb><div id="post-card" class="post-card post-sign el-col el-col-16 el-col-xs-24 el-col-sm-23 el-col-md-23 el-col-lg-16" data-v-62816cfb><div class="content__default" data-v-62816cfb><h1 id="性能优化"><a href="#性能优化" class="header-anchor">#</a> 性能优化</h1> <p><strong>1、度量标准</strong></p> <h3 id="_1-1、度量指标"><a href="#_1-1、度量指标" class="header-anchor">#</a> 1.1、度量指标</h3> <ul><li>首次有效绘制（First Meaningful Paint，简称FMP，当主要内容呈现在页面上）</li> <li>英雄渲染时间（Hero Rendering Times，度量用户体验的新指标，当用户最关心的内容渲染完成）</li> <li>可交互时间（Time to Interactive，简称TTI，指页面布局已经稳定，关键的页面字体是可见的，并且主进程可用于处理用户输入，基本上用户可以点击UI并与其交互）</li> <li>输入响应（Input responsiveness，界面响应用户输入所需的时间）</li> <li>感知速度指数（Perceptual Speed Index，简称PSI，测量页面在加载过程中视觉上的变化速度，分数越低越好）</li> <li>自定义指标，由业务需求和用户体验来决定。</li></ul> <hr> <h3 id="_1-2、设定目标"><a href="#_1-2、设定目标" class="header-anchor">#</a> 1.2、设定目标</h3> <ul><li>100毫秒的界面响应时间与60FPS</li> <li>速度指标（Speed Index）小于1250ms</li> <li>3G网络环境下可交互时间小于5s</li> <li>重要文件的大小预算小于170kb</li></ul> <p>详细信息请查看RAIL性能模型。</p> <h3 id="_1-3、网络传输性能检测工具——page-speed"><a href="#_1-3、网络传输性能检测工具——page-speed" class="header-anchor">#</a> 1.3、网络传输性能检测工具——Page Speed</h3> <p>chrome还为我们准备好了一款监测网络传输性能的插件——Page Speed。我们只需要通过下面步骤安装，就可以在chrome devtools里找到它了：chrome菜单→更多工具→拓展程序→chrome网上应用商店→搜索pagespeed后安转即可。</p> <h2 id="_2、编码优化"><a href="#_2、编码优化" class="header-anchor">#</a> 2、编码优化</h2> <p>**</p> <h3 id="_2-1-数据读取速度"><a href="#_2-1-数据读取速度" class="header-anchor">#</a> 2.1 数据读取速度</h3> <ul><li>字面量与局部变量的访问速度最快，数组元素和对象成员相对较慢</li> <li>变量从局部作用域到全局作用域的搜索过程越长速度越慢</li> <li>对象嵌套的越深，读取速度就越慢</li> <li>对象在原型链中存在的位置越深，找到它的速度就越慢</li></ul> <p><em>推荐的做法是缓存对象成员值。将对象成员值缓存到局部变量中会加快访问速度</em></p> <hr> <h3 id="_2-2-dom（重排与重绘）"><a href="#_2-2-dom（重排与重绘）" class="header-anchor">#</a> 2.2 DOM（重排与重绘）</h3> <p>应用在运行时，性能的瓶颈主要在于DOM操作的代价非常昂贵</p> <ul><li>在JS中对DOM进行访问的代价非常高。请尽可能减少访问DOM的次数（建议缓存DOM属性和元素、把DOM集合的长度缓存到变量中并在迭代中使用。读变量比读DOM的速度要快很多。）</li> <li>重排与重绘的代价非常昂贵。如果操作需要进行多次重排reflow与重绘repaint，建议先让元素脱离文档流，处理完毕后再让元素回归文档流，这样浏览器只会进行两次重排与重绘（脱离时和回归时）。CSS属性是否会触发重排或重绘 <a href="https://csstriggers.com/text-indent" target="_blank" rel="noopener noreferrer">https://csstriggers.com/text-indent<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <ol><li>CSS属性读写分离</li> <li>切换class或者style.csstext属性去批量操作元素样式</li> <li>DOM元素离线更新： 对DOM进行相关操作时，例如innerHTML、appendChild等都可以使用Document Fragment对象进行离线操作，待元素“组装”完成后再一次插入页面，或者使用<code>display:none</code> 对元素隐藏，在元素“消失”后进行相关操作。</li> <li>将没用的元素设为不可见：<code>visibility: hidden</code>，这样可以减小重绘的压力</li> <li>压缩DOM的深度，一个渲染层内不要有过深的子元素，少用DOM完成页面样式，多使用伪元素或者box-shadow取代。</li> <li>图片在渲染前指定大小：因为img元素是内联元素，所以在加载图片后会改变宽高，严重的情况会导致整个页面重排，所以最好在渲染前就指定其大小，或者让其脱离文档流。</li> <li>对页面中可能发生大量重排重绘的元素单独触发渲染层，使用GPU分担CPU压力。（这项策略需要慎用，得着重考量以牺牲GPU占用率能否换来可期的性能优化，毕竟页面中存在太多的渲染层对于GPU而言也是一种不必要的压力，通常情况下，我们会对动画元素采取硬件加速。）transform: translateZ(0)</li></ol> <ul><li>善于使用事件委托</li></ul> <hr> <h3 id="_2-3-流程控制"><a href="#_2-3-流程控制" class="header-anchor">#</a> 2.3 流程控制</h3> <ul><li>避免使用for...in（它能枚举到原型，所以很慢）</li> <li>在JS中倒序循环会略微提升性能</li> <li>减少迭代的次数</li> <li>基于循环的迭代比基于函数的迭代快8倍</li> <li>用Map表代替大量的if-else和switch会提升性能</li></ul> <h2 id="_3、静态资源优化"><a href="#_3、静态资源优化" class="header-anchor">#</a> 3、静态资源优化</h2> <h3 id="_3-1-使用brotli或zopfli进行纯文本压缩"><a href="#_3-1-使用brotli或zopfli进行纯文本压缩" class="header-anchor">#</a> 3.1 使用Brotli或Zopfli进行纯文本压缩</h3> <p>在最高级别的压缩下Brotli会非常慢（但较慢的压缩最终会得到更高的压缩率）以至于服务器在等待动态资源压缩的时间会抵消掉高压缩率带来的好处，但它非常适合静态文件压缩，因为它的解压速度很快。</p> <p>使用Zopfli压缩可以比Zlib的最大压缩提升3％至8％。</p> <p>Brotli 是一个通用目的的无损压缩算法，它通过用变种的 LZ77 算法，Huffman 编码和二阶文本建模进行数据压缩，是一种压缩比很高的压缩方法。在压缩速度上跟 Deflate 差不多，但是提供了更密集的压缩。
<a href="https://github.com/google/brotli" target="_blank" rel="noopener noreferrer">https://github.com/google/brotli<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>Zopfli 压缩算法是一个新的兼容 zlib (gzip, deflate) 的压缩器，该压缩器压缩时需要更多的时间（大约慢100倍），但压缩率比 zlib 和其他兼容压缩器要好上 5%。很适合用来做网页静态资源压缩，节约用户下载时间和运营中的流量带宽成本。
<a href="https://github.com/pierreinglebert/node-zopfli" target="_blank" rel="noopener noreferrer">https://github.com/pierreinglebert/node-zopfli<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <hr> <h3 id="_3-2-图片优化"><a href="#_3-2-图片优化" class="header-anchor">#</a> 3.2 图片优化</h3> <p>尽可能通过srcset，sizes和元素使用响应式图片。还可以通过元素使用WebP格式的图像。</p> <p><a href="https://developer.mozilla.org/zh-CN/docs/Learn/HTML/Multimedia_and_embedding/Responsive_images" target="_blank" rel="noopener noreferrer">响应式图片<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>可能大家未必听说过，但响应式布局大家肯定都听说过。响应式图片与响应式布局类似，它可以在不同屏幕尺寸与分辨率的设备上都能良好工作（比如自动切换图片大小、自动裁切图片等）。</p> <p>当然，如果您不满足这种尺度的优化，还可以对图片进行更深层次的优化。例如：模糊图片中不重要的部分以减小文件大小、使用自动播放与循环的<strong>HTML5视频替换GIF图</strong>，因为视频比GIF文件还小（好消息是未来可以通过img标签加载视频）</p> <h4 id="_3-2-1-不要在html里缩放图像"><a href="#_3-2-1-不要在html里缩放图像" class="header-anchor">#</a> 3.2.1 不要在HTML里缩放图像</h4> <h4 id="_3-2-2-使用雪碧图（css-sprite）"><a href="#_3-2-2-使用雪碧图（css-sprite）" class="header-anchor">#</a> 3.2.2 使用雪碧图（CSS Sprite）</h4> <p>webpack-spritesmith</p> <h4 id="_3-2-3-使用字体图标（iconfont）"><a href="#_3-2-3-使用字体图标（iconfont）" class="header-anchor">#</a> 3.2.3 使用字体图标（iconfont）</h4> <h4 id="_3-2-4-webp格式的图像"><a href="#_3-2-4-webp格式的图像" class="header-anchor">#</a> 3.2.4 WebP格式的图像</h4> <p>可以使用官网提供的Linux命令行工具对项目中的图片进行WebP编码，也可以使用我们的线上服务，这里我推荐叉拍云（网址：www.upyun.com/webp）</p> <h2 id="_4、交付优化"><a href="#_4、交付优化" class="header-anchor">#</a> 4、交付优化</h2> <p>交付优化指的是对页面加载资源以及用户与网页之间的交付过程进行优化。</p> <h3 id="_4-1-异步无阻塞加载js"><a href="#_4-1-异步无阻塞加载js" class="header-anchor">#</a> 4.1 异步无阻塞加载JS</h3> <p>JS的加载与执行会阻塞页面渲染，可以将Script标签放到页面的最底部。但是更好的做法是异步无阻塞加载JS。有多种无阻塞加载JS的方法：defer、async、动态创建script标签、使用XHR异步请求JS代码并注入到页面。</p> <p>但更推荐的做法是使用defer或async。如果使用defer或async请将Script标签放到head标签中，以便让浏览器更早地发现资源并在后台线程中解析并开始加载JS。</p> <hr> <h3 id="_4-2-使用intersection-observer实现懒加载"><a href="#_4-2-使用intersection-observer实现懒加载" class="header-anchor">#</a> 4.2 使用Intersection Observer实现懒加载</h3> <p>懒加载是一个比较常用的性能优化手段，下面列出了一些常用的做法：</p> <ul><li>可以通过Intersection Observer延迟加载图片、视频、广告脚本、或任何其他资源。</li> <li>可以先加载低质量或模糊的图片，当图片加载完毕后再使用完整版图片替换它。</li></ul> <p><em>延迟加载所有体积较大的组件、字体、JS、视频或Iframe是一个好主意。</em></p> <hr> <h3 id="_4-3-优先加载关键的css"><a href="#_4-3-优先加载关键的css" class="header-anchor">#</a> 4.3 优先加载关键的CSS</h3> <p>CSS资源的加载对浏览器渲染的影响很大，默认情况下浏览器只有在完成</p><head>标签中CSS的加载与解析之后才会渲染页面。如果CSS文件过大，用户就需要等待很长的时间才能看到渲染结果。针对这种情况可以将首屏渲染必须用到的CSS提取出来内嵌到<head>中，然后再将剩余部分的CSS用异步的方式加载。可以通过Critical做到这一点。<p></p> <p><a href="https://developers.google.com/web/fundamentals/performance/critical-rendering-path/optimizing-critical-rendering-path?hl=en" target="_blank" rel="noopener noreferrer">critical rendering path<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://github.com/addyosmani/critical" target="_blank" rel="noopener noreferrer">Critical<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，它是一个 Node.js 的第三方库，帮助开发者自动筛选 critical CSS
<a href="https://github.com/addyosmani/critical" target="_blank" rel="noopener noreferrer">https://github.com/addyosmani/critical<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <hr> <h3 id="_4-4-资源提示（resource-hints）"><a href="#_4-4-资源提示（resource-hints）" class="header-anchor">#</a> 4.4 资源提示（Resource Hints）</h3> <p>Resource Hints（资源提示）定义了HTML中的<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Link_types" target="_blank" rel="noopener noreferrer">Link<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>元素与dns-prefetch、preconnect、prefetch与prerender之间的关系。它可以帮助浏览器决定应该连接到哪些源，以及应该获取与预处理哪些资源来提升页面性能。</p> <h4 id="_4-4-1-dns-prefetch"><a href="#_4-4-1-dns-prefetch" class="header-anchor">#</a> 4.4.1 dns-prefetch</h4> <p>dns-prefetch可以指定一个用于获取资源所需的源（origin），并提示浏览器应该尽可能早的解析。</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>dns-prefetch<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>//example.com<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_4-4-2-preconnect"><a href="#_4-4-2-preconnect" class="header-anchor">#</a> 4.4.2 preconnect</h4> <p>preconnect用于启动预链接，其中包含DNS查找，TCP握手，以及可选的TLS协议，允许浏览器减少潜在的建立连接的开销。</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>preconnect<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>//example.com<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>preconnect<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>//cdn.example.com<span class="token punctuation">&quot;</span></span> <span class="token attr-name">crossorigin</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="_4-4-3-prefetch"><a href="#_4-4-3-prefetch" class="header-anchor">#</a> 4.4.3 prefetch</h4> <p>Prefetch用于标识下一个导航可能需要的资源。浏览器会获取该资源，一旦将来请求该资源，浏览器可以提供更快的响应。</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>prefetch<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>//example.com/next-page.html<span class="token punctuation">&quot;</span></span> <span class="token attr-name">as</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>html<span class="token punctuation">&quot;</span></span> <span class="token attr-name">crossorigin</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>use-credentials<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>prefetch<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>/library.js<span class="token punctuation">&quot;</span></span> <span class="token attr-name">as</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>script<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><em>浏览器不会预处理、不会自动执行、不会将其应用于当前上下文。</em>
as与crossorigin选项都是可选的。</p> <h4 id="_4-4-4-prerender"><a href="#_4-4-4-prerender" class="header-anchor">#</a> 4.4.4 prerender</h4> <p>prerender用于标识下一个导航可能需要的资源。浏览器会获取并执行，一旦将来请求该资源，浏览器可以提供更快的响应。</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>prerender<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>//example.com/next-page.html<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>浏览器将预加载目标页面相关的资源并执行来预处理HTML响应。</p> <h3 id="_4-5-preload"><a href="#_4-5-preload" class="header-anchor">#</a> 4.5 Preload</h3> <p>通过一个现有元素（例如：img，script，link）声明资源会将获取与执行耦合在一起。然而应用可能只是想要先获取资源，当满足某些条件时再执行资源。</p> <p><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Preloading_content" target="_blank" rel="noopener noreferrer">Preload<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>提供了预获取资源的能力，可以将获取资源的行为从资源执行中分离出来。因此，Preload可以构建自定义的资源加载与执行。</p> <p>例如，应用可以使用Preload进行CSS资源的预加载、并且同时具备：高优先级、不阻塞渲染等特性。然后应用程序在合适的时间使用CSS资源：</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token comment">&lt;!-- 通过声明性标记预加载 CSS 资源 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>preload<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>/styles/other.css<span class="token punctuation">&quot;</span></span> <span class="token attr-name">as</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>style<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- 或，通过JavaScript预加载 CSS 资源 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">var</span> res <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;link&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
res<span class="token punctuation">.</span>rel <span class="token operator">=</span> <span class="token string">&quot;preload&quot;</span><span class="token punctuation">;</span>
res<span class="token punctuation">.</span>as <span class="token operator">=</span> <span class="token string">&quot;style&quot;</span><span class="token punctuation">;</span>
res<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">&quot;styles/other.css&quot;</span><span class="token punctuation">;</span>
document<span class="token punctuation">.</span>head<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token comment">&lt;!-- 使用HTTP头预加载 --&gt;</span>
Link: &lt;https://example.com/other/styles.css&gt;; rel=preload; as=style
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_4-6-快速响应的用户界面"><a href="#_4-6-快速响应的用户界面" class="header-anchor">#</a> 4.6 快速响应的用户界面</h3> <p>PSI（Perceptual Speed Index，感知速度指数）是提升用户体验的重要指标，让用户感觉到页面的反馈比没有反馈体验要好很多。</p> <p>可以尝试使用骨架屏或添加一些Loading过渡动画提示用户体验。
输入响应（Input responsiveness）指标同样重要，甚至更重要。试想，用户点击了网页后缺毫无反应会是什么心情。JS的单线程大家已经不能再熟悉，这意味着当JS在运行时用户界面处于“锁定”状态，所以JS同步执行的时间越长，用户等待响应的时间也就越长。</p> <p>据调查，JS执行100毫秒以上用户就会明显觉得网页变卡了。所以要<strong>严格限制每个JS任务执行时间不能超过100毫秒</strong>。
解决方案是可以<strong>将一个大任务拆分成多个小任务分布在不同的Macrotask中执行</strong>（通俗的说是将大的JS任务拆分成多个小任务异步执行）。或者使用WebWorkers，它可以在UI线程外执行JS代码运算，不会阻塞UI线程，所以不会影响用户体验。</p> <h2 id="_5、构建优化"><a href="#_5、构建优化" class="header-anchor">#</a> 5、构建优化</h2> <p>现代前端应用都需要有构建的过程，项目在构建过程中是否进行了合理的优化，会对Web应用的性能有着巨大的影响。例如：影响构建后文件的体积、代码执行效率、文件加载时间、首次有效绘制指标等。</p> <h3 id="_5-1-使用预编译"><a href="#_5-1-使用预编译" class="header-anchor">#</a> 5.1 使用预编译</h3> <p>拿Vue举例，如果您使用单文件组件开发项目，组件会在编译阶段将模板编译为渲染函数。最终代码被执行时可以直接执行渲染函数进行渲染。而如果您没有使用单文件组件预编译代码，而是在网页中引入vue.min.js，那么应用在运行时需要先将模板编译成渲染函数，然后再执行渲染函数进行渲染。相比预编译，多了模板编译的步骤，所以会浪费很多性能。</p> <h3 id="_5-2-使用-tree-shaking、scope-hoisting、code-splitting"><a href="#_5-2-使用-tree-shaking、scope-hoisting、code-splitting" class="header-anchor">#</a> 5.2 使用 Tree-shaking、Scope hoisting、Code-splitting</h3> <p>Tree-shaking是一种在构建过程中清除无用代码的技术。使用Tree-shaking可以减少构建后文件的体积。</p> <p>目前Webpack与Rollup都支持Scope Hoisting。它们可以检查import链，并尽可能的将散乱的模块放到一个函数中，前提是不能造成代码冗余。所以只有被引用了一次的模块才会被合并。使用Scope Hoisting可以让代码体积更小并且可以降低代码在运行时的内存开销，同时它的运行速度更快。前面2.1节介绍了变量从局部作用域到全局作用域的搜索过程越长执行速度越慢，Scope Hoisting可以减少搜索时间。</p> <p>code-splitting是Webpack中最引人注目的特性之一。此特性能够把代码分离到不同的bundle中，然后可以按需加载或并行加载这些文件。code-splitting可以用于获取更小的bundle，以及控制资源加载优先级，如果使用合理，会极大影响加载时间。</p> <h3 id="_5-3-服务端渲染（ssr）"><a href="#_5-3-服务端渲染（ssr）" class="header-anchor">#</a> 5.3 服务端渲染（SSR）</h3> <p>单页应用需要等JS加载完毕后在前端渲染页面，也就是说在JS加载完毕并开始执行渲染操作前的这段时间里浏览器会产生白屏。
服务端渲染（Server Side Render，简称SSR）的意义在于弥补主要内容在前端渲染的成本，减少白屏时间，提升首次有效绘制的速度。可以使用服务端渲染来获得更快的首次有效绘制。
比较推荐的做法是：使用服务端渲染静态HTML来获得更快的首次有效绘制，一旦JavaScript加载完毕再将页面接管下来。</p> <h3 id="_5-4-使用import函数动态导入模块"><a href="#_5-4-使用import函数动态导入模块" class="header-anchor">#</a> 5.4 使用import函数动态导入模块</h3> <p>使用import函数可以在运行时动态地加载ES2015模块，从而实现按需加载的需求。</p> <p>这种优化在单页应用中变得尤为重要，在切换路由的时候动态导入当前路由所需的模块，会避免加载冗余的模块（试想如果在首次加载页面时一次性把整个站点所需要的所有模块都同时加载下来会加载多少非必须的JS，应该尽可能的让加载的JS更小，只在首屏加载需要的JS）。</p> <p><em>使用静态import导入初始依赖模块。其他情况下使用动态import按需加载依赖</em>
import()返回一个Promise对象</p> <ul><li>按需加载</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>button<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./dialogBox.js'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">dialogBox</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    dialogBox<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">/* Error handling */</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ul><li>条件加载</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>condition<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'moduleA'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'moduleB'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_5-5-使用http缓存头-浏览器缓存"><a href="#_5-5-使用http缓存头-浏览器缓存" class="header-anchor">#</a> 5.5 使用HTTP缓存头(浏览器缓存)</h3> <p>正确设置expires，cache-control和其他HTTP缓存头。
推荐使用Cache-control: immutable避免重新验证。</p> <h4 id="_5-5-1浏览器处理缓存的策略："><a href="#_5-5-1浏览器处理缓存的策略：" class="header-anchor">#</a> 5.5.1浏览器处理缓存的策略：</h4> <p><img src="https://cdn.nlark.com/yuque/0/2019/png/519325/1572864349270-60b1f2a7-8c35-4965-8aa8-4a934579455b.png#align=left&amp;display=inline&amp;height=539&amp;name=image.png&amp;originHeight=539&amp;originWidth=612&amp;search=&amp;size=55310&amp;status=done&amp;width=612" alt="image.png"></p> <p>在服务器上设置的Etag字段。在浏览器接收到服务器响应后，会检测响应头部（Header），如果有Etag字段，那么浏览器就会将本次缓存写入硬盘中<code>from disk cache</code>，否则就缓存在内存中<code>from memory cache</code>。</p> <p>以nginx为例，谈谈如何配置缓存:
nginx.conf中配置</p> <p><code>etag on; //开启etag验证</code> <code>expires 7d; //设置缓存过期时间为7天</code></p> <p>如果在响应头部看见Etag和Expires字段，就说明我们的缓存配置成功了。</p> <h3 id="_5-6资源打包压缩"><a href="#_5-6资源打包压缩" class="header-anchor">#</a> 5.6资源打包压缩</h3> <p>对webpack进行上线配置时，我们要特别注意以下几点：</p> <ul><li>JS压缩</li></ul> <div class="language-json line-numbers-mode"><pre class="language-json"><code>   optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
            minimizer<span class="token operator">:</span> <span class="token punctuation">[</span>
                new UglifyJsPlugin(<span class="token punctuation">{</span>
                    cache<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                    parallel<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                    sourceMap<span class="token operator">:</span> <span class="token boolean">true</span><span class="token comment">// set to true if you want JS source maps</span>
                <span class="token punctuation">}</span>)<span class="token punctuation">,</span>
                ...Plugins
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><ul><li>HTML压缩</li></ul> <div class="language-json line-numbers-mode"><pre class="language-json"><code>  new HtmlWebpackPlugin(<span class="token punctuation">{</span>
                template<span class="token operator">:</span> __dirname + '/views/index.html'<span class="token punctuation">,</span> <span class="token comment">// new 一个这个插件的实例，并传入相关的参数</span>
                filename<span class="token operator">:</span> '../index.html'<span class="token punctuation">,</span>
                minify<span class="token operator">:</span> <span class="token punctuation">{</span>
                    removeComments<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                    collapseWhitespace<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                    removeRedundantAttributes<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                    useShortDoctype<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                    removeEmptyAttributes<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                    removeStyleLinkTypeAttributes<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                    keepClosingSlash<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                    minifyJS<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                    minifyCSS<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                    minifyURLs<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                chunksSortMode<span class="token operator">:</span> 'dependency'
            <span class="token punctuation">}</span>)
```js

我们在使用`html-webpack-plugin` 自动化注入JS、CSS打包HTML文件时，很少会为其添加配置项，这里我给出样例，大家直接复制就行。据悉，在Webpack<span class="token number">5</span>中，`html-webpack-plugin` 的功能会像 `common-chunk-plugin` 那样，被集成到webpack内部，这样我们就不需要再install额外的插件了。

PS：这里有一个技巧，在我们书写HTML元素的`src` 或 `href` 属性时，可以省略协议部分，这样也能简单起到节省资源的目的。（虽然其目的本身是为了统一站内的所有协议）

③提取公共资源：
```js
    splitChunks<span class="token operator">:</span> <span class="token punctuation">{</span>
          cacheGroups<span class="token operator">:</span> <span class="token punctuation">{</span>
            vendor<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 抽离第三方插件</span>
              test<span class="token operator">:</span> /node_modules/<span class="token punctuation">,</span> <span class="token comment">// 指定是node_modules下的第三方包</span>
              chunks<span class="token operator">:</span> 'initial'<span class="token punctuation">,</span>
              name<span class="token operator">:</span> 'common/vendor'<span class="token punctuation">,</span> <span class="token comment">// 打包后的文件名，任意命名</span>
              priority<span class="token operator">:</span> <span class="token number">10</span><span class="token comment">// 设置优先级，防止和自定义的公共代码提取时被覆盖，不进行打包</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            utils<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 抽离自定义公共代码</span>
              test<span class="token operator">:</span> /\.js$/<span class="token punctuation">,</span>
              chunks<span class="token operator">:</span> 'initial'<span class="token punctuation">,</span>
              name<span class="token operator">:</span> 'common/utils'<span class="token punctuation">,</span>
              minSize<span class="token operator">:</span> <span class="token number">0</span><span class="token comment">// 只要超出0字节就生成一个新包</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br></div></div><ul><li>提取css并压缩</li></ul> <div class="language-json line-numbers-mode"><pre class="language-json"><code>    const MiniCssExtractPlugin = require('mini-css-extract-plugin')
    module<span class="token operator">:</span> <span class="token punctuation">{</span>
            rules<span class="token operator">:</span> <span class="token punctuation">[</span>...<span class="token punctuation">,</span> <span class="token punctuation">{</span>
                test<span class="token operator">:</span> /\.css$/<span class="token punctuation">,</span>
                exclude<span class="token operator">:</span> /node_modules/<span class="token punctuation">,</span>
                use<span class="token operator">:</span> <span class="token punctuation">[</span>
                    _mode === 'development' ? 'style-loader' <span class="token operator">:</span> MiniCssExtractPlugin.loader<span class="token punctuation">,</span> <span class="token punctuation">{</span>
                        loader<span class="token operator">:</span> 'css-loader'<span class="token punctuation">,</span>
                        options<span class="token operator">:</span> <span class="token punctuation">{</span>
                            importLoaders<span class="token operator">:</span> <span class="token number">1</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                        loader<span class="token operator">:</span> 'postcss-loader'<span class="token punctuation">,</span>
                        options<span class="token operator">:</span> <span class="token punctuation">{</span>
                            ident<span class="token operator">:</span> 'postcss'
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
```js

我这里配置预处理器postcss，但是我把相关配置提取到了单独的文件`postcss.config.js`里了，其中**cssnano**是一款很不错的CSS优化插件。

⑤将webpack开发环境修改为生产环境：

在使用webpack打包项目时，它常常会引入一些调试代码，以作相关调试，我们在上线时不需要这部分内容，通过配置剔除：
```js
    devtool<span class="token operator">:</span> '<span class="token boolean">false</span>'
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p>在服务器上开启Gzip传输压缩</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>gzip on;
gzip_types text/plain application/javascript application/x-javascript text/css application/xml text/javascript application/x-httpd-php application/vnd.ms-fontobject font/ttf font/opentype font/x-woff image/svg+xml;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>【！！！特别注意！！！】</strong> 
对图片进行压缩不但会占用后台大量资源，压缩效果其实并不可观，可以说是“弊大于利”，所以请在<code>gzip_types</code> 把图片的相关项去掉。</p> <p>其他一些值得考虑的优化点：</p> <ul><li>HTTP2</li> <li>使用最高级的CDN（付费的比免费的强的多）</li> <li>优化字体</li> <li>其他垂直领域的性能优化</li></ul> <h2 id="_6、性能监控"><a href="#_6、性能监控" class="header-anchor">#</a> 6、性能监控</h2> <h3 id="_6-1需要一个性能检测工具来持续监视网站的性能"><a href="#_6-1需要一个性能检测工具来持续监视网站的性能" class="header-anchor">#</a> 6.1需要一个性能检测工具来持续监视网站的性能</h3> <p><img src="https://cdn.nlark.com/yuque/0/2019/png/519325/1572847526542-4cebe483-1359-44d2-abb3-9e83bc907091.png#align=left&amp;display=inline&amp;height=416&amp;name=image.png&amp;originHeight=416&amp;originWidth=619&amp;search=&amp;size=135566&amp;status=done&amp;width=619" alt="image.png"></p> <h3 id="_6-2网络传输性能优化"><a href="#_6-2网络传输性能优化" class="header-anchor">#</a> 6.2网络传输性能优化</h3> <p>浏览器处理用户请求的过程,这是navigation timing监测指标图，从图中我们可以看出，浏览器在得到用户请求之后，经历了下面这些阶段：
重定向→拉取缓存→DNS查询→建立TCP链接→发起请求→接收响应→处理HTML元素→元素加载完成。
<img src="https://cdn.nlark.com/yuque/0/2019/png/519325/1572864168515-1f2416e1-2179-4f0f-8c31-c59877881377.png#align=left&amp;display=inline&amp;height=393&amp;name=image.png&amp;originHeight=393&amp;originWidth=662&amp;search=&amp;size=124564&amp;status=done&amp;width=662" alt="image.png"></p></head></head></div> <span id="footerPost" data-v-62816cfb></span></div> <div id="post-toc" class="post-toc el-col el-col-6" data-v-62816cfb><h4 class="catalog-title" data-v-62816cfb>TOC</h4> <div class="catalog-body" data-v-62816cfb><ul id="catalog-list" class="catalog-list" data-v-62816cfb></ul></div></div></div> <div class="post-nav el-row is-justify-space-around el-row--flex" data-v-62816cfb><div class="post-prev el-col el-col-7" data-v-62816cfb></div> <div class="post-next el-col el-col-7 el-col-lg-pull-5" data-v-62816cfb><div data-v-62816cfb><a href="/pubBlog/posts/webSafe.html" data-v-62816cfb>
          Next
          <i class="el-icon-arrow-right" data-v-62816cfb></i></a> <p class="nav-title" data-v-62816cfb>【应用专题】web 前端安全总结</p></div></div></div> <div class="el-row is-justify-center el-row--flex" data-v-62816cfb></div> <span data-v-2ab0b9b3 data-v-62816cfb><button type="button" class="el-button toc-btn el-button--primary is-circle" data-v-2ab0b9b3><!----><!----><span><i class="iconfont icon-service-directory" data-v-2ab0b9b3></i></span></button> <button type="button" class="el-button gotop-btn el-button--primary is-circle" data-v-2ab0b9b3><!----><!----><span><i class="el-icon-arrow-up" data-v-2ab0b9b3></i></span></button></span></div></main></section> <button type="button" class="el-button gotop-btn el-button--primary is-circle" style="display:none;" data-v-0ca947a2 data-v-60762676><!----><!----><span><i class="el-icon-arrow-up" data-v-0ca947a2></i></span></button></section> <footer class="el-footer container-footer" style="height:60px;" data-v-d5fdfe92 data-v-60762676><div class="footer-warp el-row is-justify-center is-align-center el-row--flex footerMargin" data-v-d5fdfe92><div class="footer-top el-col el-col-24" data-v-d5fdfe92><p class="ellipsis" data-v-d5fdfe92><span data-v-d5fdfe92>
          博客内容遵循
          <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" data-v-d5fdfe92>知识共享 署名 - 非商业性 - 相同方式共享 4.0 国际协议</a></span></p></div> <div class="footer-bottom el-col el-col-24" data-v-d5fdfe92><p class="ellipsis" data-v-d5fdfe92><span data-v-d5fdfe92><span data-v-d5fdfe92>
            dodhood © 2019-10 ~ 2019-11
          </span></span> <span data-v-d5fdfe92>
          Power by
          <a href="https://vuepress.vuejs.org/zh/" target="_blank" data-v-d5fdfe92>VuePress</a> Theme
          <a href="https://github.com/zhhlwd/vuepress-theme-indigo-material" target="_blank" data-v-d5fdfe92>indigo material</a></span></p></div></div></footer> <div class="overlay" data-v-60762676></div></div><div class="global-ui"></div></div>
    <script src="/pubBlog/assets/js/app.faf67417.js" defer></script><script src="/pubBlog/assets/js/1.9b146cf0.js" defer></script><script src="/pubBlog/assets/js/14.cac7871b.js" defer></script><script src="/pubBlog/assets/js/5.5d06c7ea.js" defer></script><script src="/pubBlog/assets/js/7.33610143.js" defer></script><script src="/pubBlog/assets/js/9.4f15c051.js" defer></script><script src="/pubBlog/assets/js/6.2819461f.js" defer></script><script src="/pubBlog/assets/js/21.7be91ae3.js" defer></script><script src="/pubBlog/assets/js/13.a9af2284.js" defer></script><script src="/pubBlog/assets/js/15.51234656.js" defer></script>
  </body>
</html>
